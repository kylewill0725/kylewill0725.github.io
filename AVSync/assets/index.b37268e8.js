import{d as e,r as a,t,w as l,o as n,c as r,a as o,b as u,e as s,f as i,g as d,h as c,i as m,j as p,k as v,p as f,l as h,F as g,m as S,n as y,q as C,s as R,u as M,v as b}from"./vendor.765de7bd.js";!function(e=".",a="__import__"){try{self[a]=new Function("u","return import(u)")}catch(t){const l=new URL(e,location),n=e=>{URL.revokeObjectURL(e.src),e.remove()};self[a]=e=>new Promise(((t,r)=>{const o=new URL(e,l);if(self[a].moduleMap[o])return t(self[a].moduleMap[o]);const u=new Blob([`import * as m from '${o}';`,`${a}.moduleMap['${o}']=m;`],{type:"text/javascript"}),s=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(u),onerror(){r(new Error(`Failed to import: ${e}`)),n(s)},onload(){t(self[a].moduleMap[o]),n(s)}});document.head.appendChild(s)})),self[a].moduleMap={}}}("assets/");var F=e({props:{src:{type:String},state:{type:Boolean,default:!1},updateTime:{type:Number,default:0}},setup(e,{emit:n}){const r=a(null),{state:o,updateTime:u}=t(e),s=(e=null)=>{const a=r.value;if(null==a)return;if(null==e)return void n("onTimeUpdate",a.currentTime);const t={id:0};return t.id=setInterval((()=>{n("onTimeUpdate",a.currentTime)}),e.delayMs),()=>clearInterval(t.id)};let i;return l(o,(()=>{const e=r.value;switch(o.value){case!0:null==e||e.play(),i=s({delayMs:.5/30});break;case!1:if(null==e)break;e.pause(),null!=i&&i(),e.currentTime+=0,s()}})),l(u,(e=>{null!=r.value&&(r.value.currentTime=e,s())})),{video:r,onMetadata:e=>{const a=e.target;a.volume=0,n("onMetadata",{duration:a.duration})}}}});async function V(e){const a=new AudioContext({sampleRate:48e3}),t=await e.arrayBuffer(),l=await a.decodeAudioData(t),n=l.getChannelData(0),r=function(e,a){const t=1/a,l=.02*a;return e.reduce(((e,a,n)=>{const r=(a-e.prevValue)/t;if(0!=e.prevVelSign&&Math.sign(r)!=e.prevVelSign&&a>.1)if(null!=e.lastSample&&e.lastSample.lastSampleNum>=n-l)e.lastSample.samples.push([e.prevIndex,e.prevValue]),e.lastSample.lastSampleNum=n;else{const a={firstSampleNum:n,lastSampleNum:n,samples:[[e.prevIndex,e.prevValue]]};e.result.push(a),e.lastSample=a}return e.prevVelSign=Math.sign(r),e.prevValue=a,e.prevIndex=n,e}),{result:[],prevVelSign:null,prevValue:0,prevIndex:-1,lastSample:null}).result}(n,l.sampleRate);return{sampleRate:l.sampleRate,sampleCount:n.length,sampleGroups:r.map((e=>e.samples)),nonZeroSampleCount:r.reduce(((e,a)=>e+a.lastSampleNum-a.firstSampleNum+1),0)}}F.render=function(e,a,t,l,o,u){return n(),r("video",{ref:"video",src:e.src,onLoadedmetadata:a[1]||(a[1]=(...a)=>e.onMetadata&&e.onMetadata(...a))},null,40,["src"])};var k=e({props:{videoFile:{type:Object},frameCount:{type:Number,default:0},currentFrame:{type:Number,default:0}},setup(e){const{frameCount:n,currentFrame:r}=t(e),o=a(null),u=a(null),s=a(null),i=l((()=>e.videoFile),(async e=>{var a,t;if(null==e)return;o.value=await V(e);const l=null==(a=u.value)?void 0:a.getContext("2d");if(null==l)return;const n=null==(t=l.canvas.parentElement)?void 0:t.getClientRects()[0];null!=n&&(l.canvas.width=Math.floor(n.width),l.canvas.height=Math.floor(n.height),l.canvas.className="h-full w-full")})),d=l([o,n,r],(([e,a,t])=>{var l;if(null==e)return;const n=null==(l=u.value)?void 0:l.getContext("2d");if(null==n)return;const r=n.canvas.width,o=n.canvas.height;n.fillStyle="white",n.fillRect(0,0,r,o),function(e,a,t){const l=e.canvas.width,n=e.canvas.height,r=Math.ceil(a.sampleCount/t),o=Array.from({length:t},((e,a)=>({samplesEnd:(a+1)*r-1,totalSampleValue:0,totalSampleCount:0,frame:a})));let u;a.sampleGroups.forEach((e=>e.forEach((e=>{(null==u||u.samplesEnd<e[0])&&(u=o.find((a=>a.samplesEnd>=e[0]))),null!=u&&(u.totalSampleCount++,u.totalSampleValue+=e[1])}))));const s=Math.ceil(l/t);e.fillStyle="aqua";for(let i=0;i<t;i++){const a=o[i].totalSampleValue/o[i].totalSampleCount||0,t=Math.max(5,a*n);e.fillRect(i*s,n-t,s,t)}}(n,e,a),function(e,a,t){const l=e.canvas.width,n=e.canvas.height,r=Math.ceil(l/t),o=(a+.5)*r;e.fillStyle="red",e.fillRect(o-1,0,1,n)}(n,t,a)}));return{canvas:u,canvasContainer:s,audioWatch:i,drawWatch:d}}});const T={class:"w-full h-full"},P={class:"",ref:"canvas"};function w(e,a){return Math.floor(e*a)}k.render=function(e,a,t,l,u,s){return n(),r("div",T,[o("canvas",P,null,512)])};const I=[23.976,24,29.97,30,60],A=[44.1,48];var L=e({components:{ChevronLeftIcon:u,ChevronRightIcon:s,ChevronDoubleLeftIcon:i,ChevronDoubleRightIcon:d,PauseIcon:c,PlayIcon:m,FolderOpenIcon:p},props:{isPlaying:{type:Boolean,default:!1},frameRate:{type:Number,default:I[3]},sampleRate:{type:Number,default:A[1]},currentTime:{type:Number,default:0}},setup(e,{emit:l}){const{currentTime:n,frameRate:r}=t(e),o=a(0),u=a(0);return{supportedFrameRates:I,supportedSampleRates:A,updateFrameRate(e){const a=e.target;l("frameRateChanged",Number(a.value))},updateSampleRate(e){const a=e.target;l("sampleRateChanged",Number(a.value))},updateVideoPath(e){var a;const t=null==(a=e.target.files)?void 0:a.item(0);if(null==t)throw"File cannot be null";const n=URL.createObjectURL(t);l("videoSelected",{path:n,file:t})},updateVideoMarker(){u.value=n.value},updateAudioMarker(){o.value=n.value},setPlayState(e){l("playToggle",e)},shiftFrames(e){l("onFrameShift",e)},audioMarker:o,videoMarker:u,diffMarker:v((()=>u.value-o.value)),formattedTime:v((()=>{const e=w(n.value,r.value);return`${Math.floor(1e3*n.value)}ms (Frame #${e})`})),toMs:e=>Math.floor(1e3*e)}}});const N=R();f("data-v-2e78d856");const O={class:"grid grid-cols-3"},U={class:"flex markButton w-min"},x=o("span",null,"Open",-1),j=o("label",null,"Frame Rate",-1),D=o("br",null,null,-1),E=o("option",null,"Custom",-1),B=o("br",null,null,-1),$=o("label",null,"Sample Rate",-1),_=o("br",null,null,-1),q=o("option",null,"Custom",-1),G={class:"mediaControl"},W={class:"mediaControl"},z={class:"mediaControl"},Z={class:"mediaControl"};h();const H=N(((e,a,t,l,u,s)=>{const i=M("FolderOpenIcon"),d=M("ChevronDoubleLeftIcon"),c=M("ChevronLeftIcon"),m=M("PauseIcon"),p=M("PlayIcon"),v=M("ChevronRightIcon"),f=M("ChevronDoubleRightIcon");return n(),r("div",O,[o("div",null,[o("label",U,[o(i,{class:"h-6 text-blue-400"}),x,o("input",{type:"file",accept:"video/*",onChange:a[1]||(a[1]=(...a)=>e.updateVideoPath&&e.updateVideoPath(...a)),hidden:""},null,32)]),j,D,o("select",{name:"FrameRate",onChange:a[2]||(a[2]=(...a)=>e.updateFrameRate&&e.updateFrameRate(...a))},[(n(!0),r(g,null,S(e.supportedFrameRates,(e=>(n(),r("option",{key:e,selected:30===e,value:e},C(e)+" fps ",9,["selected","value"])))),128)),E],32),B,$,_,o("select",{name:"SampleRate",onChange:a[3]||(a[3]=(...a)=>e.updateSampleRate&&e.updateSampleRate(...a))},[(n(!0),r(g,null,S(e.supportedSampleRates,(e=>(n(),r("option",{key:e,selected:48===e,value:e},C(e)+" khz ",9,["selected","value"])))),128)),q],32)]),o("div",null,[o("button",G,[o(d)]),o("button",W,[o(c,{onClick:a[4]||(a[4]=a=>e.shiftFrames(-1))})]),e.isPlaying?(n(),r("button",{key:0,class:"mediaControl",onClick:a[5]||(a[5]=a=>e.setPlayState(!1))},[o(m)])):y("",!0),e.isPlaying?y("",!0):(n(),r("button",{key:1,class:"mediaControl",onClick:a[6]||(a[6]=a=>e.setPlayState(!0))},[o(p)])),o("button",z,[o(v,{onClick:a[7]||(a[7]=a=>e.shiftFrames(1))})]),o("button",Z,[o(f)])]),o("div",null,[o("button",{class:"markButton",onClick:a[8]||(a[8]=(...a)=>e.updateVideoMarker&&e.updateVideoMarker(...a))},"Mark Video"),o("button",{class:"markButton",onClick:a[9]||(a[9]=(...a)=>e.updateAudioMarker&&e.updateAudioMarker(...a))},"Mark Audio"),o("p",null,"Difference: "+C(e.toMs(e.diffMarker))+"ms",1),o("p",null,"Time: "+C(e.formattedTime),1)])])}));L.render=H,L.__scopeId="data-v-2e78d856";var J=e({components:{AVSVideo:F,AVSAudio:k,AVSControls:L},setup(){const e=a(void 0),t=a(void 0),l=a(0),n=a(!1),r=a(30),o=a(0),u=a(0),s=v((()=>Math.round(l.value*r.value))),i=v((()=>Array.from({length:s.value},((e,a)=>a/r.value+.5/r.value)))),d=v((()=>w(o.value,r.value)));return{videoFilePath:e,videoFile:t,videoDuration:l,frames:s,isPlaying:n,frameRate:r,currentTime:o,updateTime:u,currentFrame:d,frameTimeArray:i,updateVideoPath(a){null!=e.value&&URL.revokeObjectURL(e.value),e.value=a.path,t.value=a.file},updateVideoMetadata(e){l.value=e.duration},updateIsPlaying(e){n.value=e},updateFrameRate(e){r.value=e},updateCurrentTime(e){o.value=e},shiftFrames(e){u.value=(d.value+e+.5)/r.value},timeString:v((()=>o.value))}}});const K={class:"h-screen grid grid-rows-layout"};J.render=function(e,a,t,l,u,s){const i=M("AVSAudio"),d=M("AVSVideo"),c=M("AVSControls");return n(),r("div",K,[o(i,{class:"",videoFile:e.videoFile,frameCount:e.frames,currentFrame:e.currentFrame},null,8,["videoFile","frameCount","currentFrame"]),o(d,{class:"bg-gray-500 h-full w-full",src:e.videoFilePath,state:e.isPlaying,updateTime:e.updateTime,onOnTimeUpdate:e.updateCurrentTime,onOnMetadata:e.updateVideoMetadata},null,8,["src","state","updateTime","onOnTimeUpdate","onOnMetadata"]),o(c,{class:"",isPlaying:e.isPlaying,frameRate:e.frameRate,currentTime:e.timeString,onFrameRateChanged:e.updateFrameRate,onVideoSelected:e.updateVideoPath,onOnFrameShift:e.shiftFrames,onPlayToggle:e.updateIsPlaying},null,8,["isPlaying","frameRate","currentTime","onFrameRateChanged","onVideoSelected","onOnFrameShift","onPlayToggle"])])};const Q={components:{Manager:J}},X={id:"app"};Q.render=function(e,a,t,l,u,s){const i=M("Manager");return n(),r("div",X,[o(i)])};b(Q).mount("#app");
